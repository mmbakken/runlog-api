import {} from 'dotenv/config.js'
import { DateTime } from 'luxon'
import connectToMongo from '../../db/connectToMongo.js'
import disconnectFromMongo from '../../db/disconnectFromMongo.js'
import RunModel from '../../db/RunModel.js'
import DailyStatsModel from '../../db/DailyStatsModel.js'
import TrainingModel from '../../db/TrainingModel.js'
import UserModel from '../../db/UserModel.js'

import createRunFromStravaActivity from '../../runs/createRunFromStravaActivity.js'

// Script to create run (and matching DailyStats objects) in local development database.
// Do not use this script on prod!

const initializeDevDatabase = async () => {
  await connectToMongo()

  if (process?.env?.APP_ENV !== 'dev') {
    console.erorr(
      'Do not use this script in prod! It drops all of the plans, runs, and daily stats. Only use in dev.'
    )
    return -1
  }

  try {
    await RunModel.deleteMany({})
    await DailyStatsModel.deleteMany({})
    await TrainingModel.deleteMany({})

    const email = 'mmbakken@gmail.com'
    const user = await UserModel.findOne({ email: email })

    if (user == null) {
      console.error(`No user id found with email: ${email}`)
      return -1
    }

    let date = DateTime.now().startOf('day')
    let index = 0

    const runs = [
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:46:33Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:46:33Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2491,
        distance: 8497.1,
        average_speed: 3.411,
        total_elevation_gain: 57.7,
        has_heartrate: true,
        average_heartrate: 149.3,
        max_heartrate: 167,
        device_name: 'Garmin Forerunner 245',
        id: '4874302952',
        external_id: 'garmin_push_6358009720',
        start_latlng: [39.758085, -104.989269],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:21:03Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:21:03Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 4101,
        distance: 14485.2,
        average_speed: 3.532,
        total_elevation_gain: 27.3,
        has_heartrate: true,
        average_heartrate: 167.1,
        max_heartrate: 194,
        device_name: 'Garmin Forerunner 245',
        id: '4880376076',
        external_id: 'garmin_push_6363925616',
        start_latlng: [39.758198, -104.98944],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index }).toISODate()}T00:59:21Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T17:59:21Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2119,
        distance: 6983.6,
        average_speed: 3.296,
        total_elevation_gain: 51.1,
        has_heartrate: true,
        average_heartrate: 147.4,
        max_heartrate: 167,
        device_name: 'Garmin Forerunner 245',
        id: '4886692498',
        external_id: 'garmin_push_6370123399',
        start_latlng: [39.758064, -104.98935],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T23:07:39Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T17:07:39Z`,
        timezone: '(GMT-06:00) America/Chicago',
        moving_time: 16,
        distance: 28.3,
        average_speed: 1.769,
        total_elevation_gain: 0,
        has_heartrate: true,
        average_heartrate: 89.5,
        max_heartrate: 104,
        device_name: 'Garmin Forerunner 245',
        id: '4753054969',
        external_id: 'garmin_push_6237712258',
        start_latlng: [null, null],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:44:02Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:44:02Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2270,
        distance: 7506,
        average_speed: 3.307,
        total_elevation_gain: 37.2,
        has_heartrate: true,
        average_heartrate: 146.6,
        max_heartrate: 164,
        device_name: 'Garmin Forerunner 245',
        id: '4757494299',
        external_id: 'garmin_push_6242349984',
        start_latlng: [39.758129, -104.989579],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Lunch Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T19:09:04Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T12:09:04Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 4278,
        distance: 14555.3,
        average_speed: 3.402,
        total_elevation_gain: 33.2,
        has_heartrate: true,
        average_heartrate: 151.4,
        max_heartrate: 182,
        device_name: 'Garmin Forerunner 245',
        id: '4761989909',
        external_id: 'garmin_push_6246949482',
        start_latlng: [39.758377, -104.989355],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T20:47:09Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T13:47:09Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2401,
        distance: 8182.7,
        average_speed: 3.408,
        total_elevation_gain: 86.7,
        has_heartrate: true,
        average_heartrate: 148.4,
        max_heartrate: 174,
        device_name: 'Garmin Forerunner 245',
        id: '4767474275',
        external_id: 'garmin_push_6252364608',
        start_latlng: [39.759744, -104.990506],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T21:06:01Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T14:06:01Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2290,
        distance: 8479,
        average_speed: 3.703,
        total_elevation_gain: 21.5,
        has_heartrate: true,
        average_heartrate: 156.5,
        max_heartrate: 182,
        device_name: 'Garmin Forerunner 245',
        id: '4772578968',
        external_id: 'garmin_push_6257468361',
        start_latlng: [39.758117, -104.989318],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T21:58:28Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T14:58:28Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 703,
        distance: 2339.7,
        average_speed: 3.328,
        total_elevation_gain: 12,
        has_heartrate: true,
        average_heartrate: 150.3,
        max_heartrate: 161,
        device_name: 'Garmin Forerunner 245',
        id: '4772659279',
        external_id: 'garmin_push_6257542702',
        start_latlng: [39.754881, -105.008709],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:07:11Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:07:11Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 3081,
        distance: 9962.6,
        average_speed: 3.234,
        total_elevation_gain: 58.5,
        has_heartrate: true,
        average_heartrate: 141.8,
        max_heartrate: 164,
        device_name: 'Garmin Forerunner 245',
        id: '4777376553',
        external_id: 'garmin_push_6262286033',
        start_latlng: [39.758243, -104.989547],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T20:12:29Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T13:12:29Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 5617,
        distance: 17334.9,
        average_speed: 3.086,
        total_elevation_gain: 91.2,
        has_heartrate: true,
        average_heartrate: 140.4,
        max_heartrate: 168,
        device_name: 'Garmin Forerunner 245',
        id: '4782719373',
        external_id: 'garmin_push_6267604327',
        start_latlng: [39.758024, -104.989358],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T00:07:08Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T17:07:08Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 3539,
        distance: 11264.8,
        average_speed: 3.183,
        total_elevation_gain: 67.4,
        has_heartrate: true,
        average_heartrate: 144.8,
        max_heartrate: 171,
        device_name: 'Garmin Forerunner 245',
        id: '4809846142',
        external_id: 'garmin_push_6294403903',
        start_latlng: [39.758209, -104.989565],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:43:49Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:43:49Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 3406,
        distance: 11585,
        average_speed: 3.401,
        total_elevation_gain: 82.6,
        has_heartrate: true,
        average_heartrate: 150,
        max_heartrate: 166,
        device_name: 'Garmin Forerunner 245',
        id: '4820647980',
        external_id: 'garmin_push_6305173264',
        start_latlng: [39.758137, -104.989531],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Lunch Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T18:22:44Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T11:22:44Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 4317,
        distance: 14486.6,
        average_speed: 3.356,
        total_elevation_gain: 46.8,
        has_heartrate: true,
        average_heartrate: 145.2,
        max_heartrate: 165,
        device_name: 'Garmin Forerunner 245',
        id: '4826856507',
        external_id: 'garmin_push_6311163606',
        start_latlng: [39.758221, -104.989561],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T20:35:00Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T13:35:00Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 3746,
        distance: 12938,
        average_speed: 3.454,
        total_elevation_gain: 65.5,
        has_heartrate: true,
        average_heartrate: 145.9,
        max_heartrate: 164,
        device_name: 'Garmin Forerunner 245',
        id: '4832308214',
        external_id: 'garmin_push_6316766218',
        start_latlng: [39.758389, -104.98955],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Evening Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T01:07:59Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T18:07:59Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2003,
        distance: 6620.9,
        average_speed: 3.305,
        total_elevation_gain: 36.1,
        has_heartrate: true,
        average_heartrate: 147.3,
        max_heartrate: 163,
        device_name: 'Garmin Forerunner 245',
        id: '4839117806',
        external_id: 'garmin_push_6323479433',
        start_latlng: [39.758142, -104.989616],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T20:42:11Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T13:42:11Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 2622,
        distance: 8645.2,
        average_speed: 3.297,
        total_elevation_gain: 30.2,
        has_heartrate: true,
        average_heartrate: 140.1,
        max_heartrate: 152,
        device_name: 'Garmin Forerunner 245',
        id: '4844225231',
        external_id: 'garmin_push_6328590955',
        start_latlng: [39.758287, -104.989347],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:10:59Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:10:59Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 4073,
        distance: 14485.6,
        average_speed: 3.556,
        total_elevation_gain: 67.2,
        has_heartrate: true,
        average_heartrate: 166.5,
        max_heartrate: 189,
        device_name: 'Garmin Forerunner 245',
        id: '4855632620',
        external_id: 'garmin_push_6339781218',
        start_latlng: [39.758031, -104.98953],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T21:10:41Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T14:10:41Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 1985,
        distance: 6675.1,
        average_speed: 3.363,
        total_elevation_gain: 19.8,
        has_heartrate: true,
        average_heartrate: 156.6,
        max_heartrate: 173,
        device_name: 'Garmin Forerunner 245',
        id: '4861671029',
        external_id: 'garmin_push_6345616686',
        start_latlng: [39.758248, -104.989368],
      },
      {
        userId: user._id,
        type: 'Run',
        name: 'Afternoon Run',
        start_date: `${date.minus({ days: index++ }).toISODate()}T22:13:18Z`,
        start_date_local: `${date.minus({ days: index }).toISODate()}T15:13:18Z`,
        timezone: '(GMT-07:00) America/Denver',
        moving_time: 4871,
        distance: 16498.2,
        average_speed: 3.387,
        total_elevation_gain: 70.6,
        has_heartrate: true,
        average_heartrate: 154.6,
        max_heartrate: 174,
        device_name: 'Garmin Forerunner 245',
        id: '4869015580',
        external_id: 'garmin_push_6352855911',
        start_latlng: [39.758062, -104.989196],
      },
    ]

    for (let run of runs) {
      await createRunFromStravaActivity(user, run)
    }

    console.log('Created all runs and daily stats')
    return 1
  } catch (error) {
    console.error(error)
    return -1
  } finally {
    disconnectFromMongo()
  }
}

initializeDevDatabase()
